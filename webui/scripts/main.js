"use strict";angular.module("edmApp",["ngMaterial","ngAnimate","ui.router","pascalprecht.translate","ui.ace","angular-keyboard","satellizer","ngMessages"]),angular.module("edmApp").config(["$mdThemingProvider","$locationProvider","$urlRouterProvider","$stateProvider","$translateProvider","$authProvider",function(e,t,n,r,i,o){i.useStaticFilesLoader({prefix:"locales/",suffix:".json"}),i.useSanitizeValueStrategy("escape"),i.determinePreferredLanguage(),i.fallbackLanguage("en-EN"),n.otherwise("/"),t.html5Mode({enabled:!0,requireBase:!0}),o.github({url:"http://digitalocean.thenino.net:3000/callback",scope:["user:email","gist"],clientId:"787c3c6b224affb21524",redirectUri:window.location.origin}),r.state("app",{controllerAs:"app",url:"/",controller:"AppController",templateUrl:"views/app.html"})}]),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},angular.module("edmApp").directive("fileDropper",["$parse",function(e){return{restrict:"A",transclude:!0,template:['<div class="dropper-overlay" translate>DROP_YOUR_FILE_HERE</div>',"<div ng-transclude></div>"].join(""),link:function(t,n,r){var i=new Dragster(n[0]),o=e(r.fileDropper);n.bind("dragover",function(e){return e.stopPropagation(),e.preventDefault(),!1}),n.bind("dragster:enter",function(e){return e.stopPropagation(),e.preventDefault(),angular.element(this).children().eq(0).addClass("active"),!1}),n.bind("dragster:leave",function(e){return e.stopPropagation(),e.preventDefault(),angular.element(this).children().eq(0).removeClass("active"),!1}),n.bind("drop",function(e){e.stopPropagation(),e.preventDefault(),i.dragleave(e);var n=new FileReader,r={name:e.dataTransfer.files[0].name,size:e.dataTransfer.files[0].size};return n.readAsText(e.dataTransfer.files[0]),n.onload=function(n){r.content=n.target.result,t.$apply(function(){o(t,{$event:e,$file:r})})},!1})}}}]),angular.module("edmApp").directive("fileOpener",["$parse",function(e){return{restrict:"A",link:function(t,n,r){var i=e(r.fileOpener);n.bind("change",function(e){t.$apply(function(){i(t,{$event:e,$file:n[0].files[0]})})})}}}]),angular.module("edmApp").directive("register",function(){function e(e,t,n){return Array(t-String(e).length+1).join(n||"0")+e}return{restrict:"E",transclude:!1,replace:!0,scope:{name:"=",value:"=",format:"="},template:['<div class="register">','<div ng-bind="vm.name"></div>','<div ng-bind="vm.convertedValue">aa</div>',"</div>"].join(""),bindToController:!0,controllerAs:"vm",controller:["$scope",function(t){var n=this;t.$watchGroup(["vm.format","vm.value"],function(){var t=arguments[0][0],r=arguments[0][1];switch(t){case"hex":n.convertedValue=e(r.toString(16),16).toUpperCase();break;case"bit":n.convertedValue=e((r>>>0).toString(2),64);break;default:n.convertedValue=e(r,19)}})}]}}),angular.module("edmApp").controller("AppController",["$scope","$log","$translate","$mdSidenav","$mdMedia","$mdDialog","$q",function(e,t,n,r,i,o,a){function l(e,t){return Math.floor(Math.random()*(t-e))+e}var u=this,s=!1,c=function(){var e=n.instant("DISCARD_CHANGES").capitalizeFirstLetter(),t=n.instant("WOULD_YOU_LIKE_TO_DISCARD_YOUR_CHANGES").capitalizeFirstLetter(),r=n.instant("OK"),i=n.instant("CANCEL"),l=o.confirm().title(e).textContent(t).ariaLabel("Confirm discard").targetEvent(event).ok(r).cancel(i);return s?o.show(l):a.when(!0)};u.locs=0,u.editorContent="",u.filesize=0,u.filename="new_file.s",u.format="hex",u.customFullscreen=i("xs")||i("sm"),u.toggleMenu=function(){r("left").toggle()},u.aceLoaded=function(e){e.getSession().getDocument().setNewLineMode("unix")},u.editorChanged=function(e){u.locs=e[1].env.document.getLength(),u.filesize=u.editorContent.length,s=!0},u.openSourceDialog=function(e){c().then(function(){var n=(i("sm")||i("xs"))&&u.customFullscreen;o.show({controller:"OpenDialogController",controllerAs:"vm",templateUrl:"views/open-dialog.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:n}).then(function(e){u.filename=e.name,u.editorContent=e.content,s=!1},function(){t.log("Open dialog rejected")})})},u.openSettingsDialog=function(e){var n=(i("sm")||i("xs"))&&u.customFullscreen;o.show({controller:"SettingsDialogController",controllerAs:"vm",templateUrl:"views/settings-dialog.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:n}).then(function(e){t.log("Settings dialog resolved",e)},function(){t.log("Settings dialog rejected")})},u.onDropFile=function(e,t){return c().then(function(){u.filename=t.name,u.editorContent=t.content,s=!1})},u.registers=[],u.runSingle=function(){t.log("Run single step invoked")},u.runMulti=function(){t.log("Run multi-cycle invoked")},u.stop=function(){t.log("Stop invoked")},u.runAll=function(){t.log("Run invoked");var e=new jsedumips64.WebUi;e.init();var n=e.loadProgram(u.editorContent);0!=n.length?t.error(n):(t.log(e.getRegisters()),t.log(e.getMemory()),t.log(e.getStatistics()))},e.$watch(function(){return i("xs")||i("sm")},function(t){e.customFullscreen=t===!0});for(var d=0;d<32;d++)u.registers.push({name:"R"+d,value:l(0,Number.MAX_SAFE_INTEGER)});for(var d=0;d<32;d++)u.registers.push({name:"F"+d,value:l(0,Number.MAX_SAFE_INTEGER)});u.registers.push({name:"LO",value:l(0,Number.MAX_SAFE_INTEGER)}),u.registers.push({name:"HI",value:l(0,Number.MAX_SAFE_INTEGER)})}]),angular.module("edmApp").controller("SettingsDialogController",["$mdDialog",function(e){var t=this;t.availableLanguages={"en-EN":"English","it-IT":"Italiano"},t.ok=function(){e.hide()},t.cancel=function(){e.cancel()}}]),angular.module("edmApp").controller("OpenDialogController",["$mdDialog","$auth","$scope","$http","$window",function(e,t,n,r,i){var o=this,a=function(){return r({url:"https://api.github.com/gists",method:"GET"}).then(function(e){o.gists.length=0,e.data.forEach(function(e){Object.keys(e.files).forEach(function(t){o.gists.push({name:t,size:e.files[t].size,url:e.files[t].raw_url,created:e.created_at,updated:e.updated_at,ownerLogin:e.owner.login,ownerAvatar:e.owner.avatar_url})})})})};o.isAuthenticated=!1,o.gists=[],o.url=null,o.preview={},o.auth=function(e){return t.authenticate("github")},o.onFileOpen=function(t,n){var r=new FileReader;r.readAsText(n),r.onload=function(t){e.hide({name:n.name,content:t.target.result})},r.onerror=function(){console.error("Unable to read "+n.name)}},o.openGist=function(t){r({url:t.url,method:"get",skipAuthorization:!0}).then(function(e){return{name:t.name,content:e.data}}).then(e.hide)},o.ok=function(){e.hide(o.preview)},o.cancel=function(){e.cancel()},n.$watch(t.isAuthenticated,function(e){o.isAuthenticated=e}),n.$watch("vm.isAuthenticated",function(e){e&&a()}),n.$watch("vm.url",function(e){if(e){var t=e.split("/").slice(-1)[0];r({url:e,method:"get",skipAuthorization:!0}).then(function(e){o.preview={name:t,content:e.data}})}else o.preview={}})}]);