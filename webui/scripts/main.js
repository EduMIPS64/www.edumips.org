"use strict";angular.module("edmApp",["ngMaterial","ngAnimate","ui.router","pascalprecht.translate","ui.ace","angular-keyboard","satellizer"]),angular.module("edmApp").config(["$mdThemingProvider","$locationProvider","$urlRouterProvider","$stateProvider","$translateProvider","$authProvider",function(e,t,n,r,o,i){o.useStaticFilesLoader({prefix:"locales/",suffix:".json"}),o.useSanitizeValueStrategy("escape"),o.determinePreferredLanguage(),o.fallbackLanguage("en-EN"),n.otherwise("/"),t.html5Mode({enabled:!0,requireBase:!0}),i.github({url:"http://digitalocean.thenino.net:3000/callback",scope:["user:email","gist"],clientId:"787c3c6b224affb21524",redirectUri:window.location.origin}),r.state("app",{controllerAs:"app",url:"/",controller:"AppController",templateUrl:"views/app.html"})}]),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},angular.module("edmApp").directive("fileDropper",["$parse",function(e){return{restrict:"A",transclude:!0,template:['<div class="dropper-overlay" translate>DROP_YOUR_FILE_HERE</div>',"<div ng-transclude></div>"].join(""),link:function(t,n,r){var o=new Dragster(n[0]),i=e(r.fileDropper);n.bind("dragover",function(e){return e.stopPropagation(),e.preventDefault(),!1}),n.bind("dragster:enter",function(e){return e.stopPropagation(),e.preventDefault(),angular.element(this).children().eq(0).addClass("active"),!1}),n.bind("dragster:leave",function(e){return e.stopPropagation(),e.preventDefault(),angular.element(this).children().eq(0).removeClass("active"),!1}),n.bind("drop",function(e){e.stopPropagation(),e.preventDefault(),o.dragleave(e);var n=new FileReader,r={name:e.dataTransfer.files[0].name,size:e.dataTransfer.files[0].size};return n.readAsText(e.dataTransfer.files[0]),n.onload=function(n){r.content=n.target.result,t.$apply(function(){i(t,{$event:e,$file:r})})},!1})}}}]),angular.module("edmApp").directive("register",function(){function e(e,t,n){return Array(t-String(e).length+1).join(n||"0")+e}return{restrict:"E",transclude:!1,replace:!0,scope:{name:"=",value:"=",format:"="},template:['<div class="register">','<div ng-bind="vm.name"></div>','<div ng-bind="vm.convertedValue">aa</div>',"</div>"].join(""),bindToController:!0,controllerAs:"vm",controller:["$scope",function(t){var n=this;t.$watchGroup(["vm.format","vm.value"],function(){var t=arguments[0][0],r=arguments[0][1];switch(t){case"hex":n.convertedValue=e(r.toString(16),16).toUpperCase();break;case"bit":n.convertedValue=e((r>>>0).toString(2),64);break;default:n.convertedValue=e(r,19)}})}]}}),angular.module("edmApp").controller("AppController",["$scope","$log","$translate","$mdSidenav","$mdMedia","$mdDialog","$q",function(e,t,n,r,o,i,a){function l(e,t){return Math.floor(Math.random()*(t-e))+e}var s=this,u=!1;s.locs=0,s.editorContent="",s.filesize=0,s.filename="new_file.s",s.format="hex",s.customFullscreen=o("xs")||o("sm"),s.toggleMenu=function(){r("left").toggle()},s.aceLoaded=function(e){e.getSession().getDocument().setNewLineMode("unix")},s.editorChanged=function(e){s.locs=e[1].env.document.getLength(),s.filesize=s.editorContent.length,u=!0},s.openSourceDialog=function(e){var n=(o("sm")||o("xs"))&&s.customFullscreen;i.show({controller:"OpenDialogController",controllerAs:"vm",templateUrl:"views/open-dialog.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:n}).then(function(e){t.log("Open dialog resolved",e)},function(){t.log("Open dialog rejected")})},s.openSettingsDialog=function(e){var n=(o("sm")||o("xs"))&&s.customFullscreen;i.show({controller:"SettingsDialogController",controllerAs:"vm",templateUrl:"views/settings-dialog.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:n}).then(function(e){t.log("Settings dialog resolved",e)},function(){t.log("Settings dialog rejected")})},s.onDropFile=function(e,t){var r=n.instant("DISCARD_CHANGES").capitalizeFirstLetter(),o=n.instant("WOULD_YOU_LIKE_TO_DISCARD_YOUR_CHANGES").capitalizeFirstLetter(),l=n.instant("OK"),c=n.instant("CANCEL"),d=i.confirm().title(r).textContent(o).ariaLabel("Confirm discard").targetEvent(e).ok(l).cancel(c),g=null;return g=u?i.show(d):a.when(!0),g.then(function(){s.filename=t.name,s.editorContent=t.content,u=!1})},s.registers=[],s.runSingle=function(){t.log("Run single step invoked")},s.runMulti=function(){t.log("Run multi-cycle invoked")},s.stop=function(){t.log("Stop invoked")},s.runAll=function(){t.log("Run invoked"),t.log(s.editorContent);var e=new jsedumips64.WebUi;e.init();var n=e.runProgram(s.editorContent);0!=n.length?t.error(n):(t.log(e.getRegisters()),t.log(e.getMemory()),t.log(e.getStatistics()))},e.$watch(function(){return o("xs")||o("sm")},function(t){e.customFullscreen=t===!0});for(var c=0;c<32;c++)s.registers.push({name:"R"+c,value:l(0,Number.MAX_SAFE_INTEGER)});for(var c=0;c<32;c++)s.registers.push({name:"F"+c,value:l(0,Number.MAX_SAFE_INTEGER)});s.registers.push({name:"LO",value:l(0,Number.MAX_SAFE_INTEGER)}),s.registers.push({name:"HI",value:l(0,Number.MAX_SAFE_INTEGER)})}]),angular.module("edmApp").controller("SettingsDialogController",["$mdDialog",function(e){var t=this;t.availableLanguages={"en-EN":"English","it-IT":"Italiano"},t.ok=function(){e.hide()},t.cancel=function(){e.cancel()}}]),angular.module("edmApp").controller("OpenDialogController",["$mdDialog","$auth","$scope","$http","$window",function(e,t,n,r,o){var i=this,a=function(){return r({url:"https://api.github.com/gists",method:"GET"}).then(function(e){i.gists.length=0,e.data.forEach(function(e){Object.keys(e.files).forEach(function(t){i.gists.push({name:t,size:e.files[t].size,url:e.files[t].raw_url,created:e.created_at,updated:e.updated_at,ownerLogin:e.owner.login,ownerAvatar:e.owner.avatar_url})})})})};i.isAuthenticated=!1,i.gists=[],i.auth=function(e){return t.authenticate("github")},i.ok=function(){e.hide()},i.cancel=function(){e.cancel()},n.$watch(t.isAuthenticated,function(e){i.isAuthenticated=e}),n.$watch("vm.isAuthenticated",function(e){e&&a()})}]);